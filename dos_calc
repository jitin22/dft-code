#!/bin/bash
# Script to perform band structure calculation

PREFIX="sil"
ELEMENT="Si"

# Path to pw.x executable
ESPRESSO_PW="pw.x"

# Equilibrium lattice parameter.
LATT_EQ=10.2100 # enter in bohr

# k-mesh dimensions
K_MESH=9

# Ecut value
ECUT=30.00  # enter in Ry

# Create *.scf.in file to perform SCF calculation.
cat>$ELEMENT.scf.in<<EOF
 &control
    calculation='scf'
    restart_mode='from_scratch',
    pseudo_dir='./',
    outdir='./'
    prefix='$PREFIX',
 /
 &system    
    ibrav=2, celldm(1)=$LATT_EQ, nat=2, ntyp=1,
    ecutwfc =$ECUT
 /
 &electrons
    conv_thr =  1.0d-8
    mixing_beta = 0.7
    diagonalization = 'david'
 /

 &dos
    prefix = 'sil',
    outdir = './',
    ngauss = 0,
    degauss = 0.003, ! in Ry units
    DeltaE = 0.001,
    fildos = 'dos.dat'
 /

ATOMIC_SPECIES
 $ELEMENT   28.0855   Si.pz-vbc.UPF 
ATOMIC_POSITIONS
 $ELEMENT  0.00 0.00 0.00
 $ELEMENT  0.25 0.25 0.25
K_POINTS  {automatic}
$K_MESH $K_MESH $K_MESH 0 0 0
EOF

$ESPRESSO_PW  < $ELEMENT.scf.in > $ELEMENT.scf.out

echo Completed SCF calculation. Now starting bands calculation...

# Create *.band.in file to perform the band structure calculation by making
# use of self-consistent charge density from the previous SCF calculation.
cat>$ELEMENT.band.in<<EOF
 &control
    calculation='bands'
    pseudo_dir = './',
    outdir='./',
    prefix='$PREFIX'
 /
 &system
    ibrav=  2, celldm(1) =$LATT_EQ, nat=  2, ntyp= 1,
    ecutwfc =$ECUT, nbnd=8
 /
 &electrons
    conv_thr =  1.0d-8
    mixing_beta = 0.7
    diagonalization='david'
 /
ATOMIC_SPECIES
 $ELEMENT  28.0855  Si.pz-vbc.UPF
ATOMIC_POSITIONS
 $ELEMENT 0.00 0.00 0.00
 $ELEMENT 0.25 0.25 0.25
K_POINTS
 81 
     0.00000    0.00000    0.00000  0.1
     0.00000    0.05000    0.00000  0.1
     0.00000    0.10000    0.00000  0.1
     0.00000    0.15000    0.00000  0.1
     0.00000    0.20000    0.00000  0.1
     0.00000    0.25000    0.00000  0.1
     0.00000    0.30000    0.00000  0.1
     0.00000    0.35000    0.00000  0.1
     0.00000    0.40000    0.00000  0.1
     0.00000    0.45000    0.00000  0.1
     0.00000    0.50000    0.00000  0.1
     0.00000    0.55000    0.00000  0.1
     0.00000    0.60000    0.00000  0.1
     0.00000    0.65000    0.00000  0.1
     0.00000    0.70000    0.00000  0.1
     0.00000    0.75000    0.00000  0.1
     0.00000    0.80000    0.00000  0.1
     0.00000    0.85000    0.00000  0.1
     0.00000    0.90000    0.00000  0.1
     0.00000    0.95000    0.00000  0.1
     0.00000    1.00000    0.00000  0.1
     0.03750    0.98750    0.00000  0.1
     0.07500    0.97500    0.00000  0.1
     0.11250    0.96250    0.00000  0.1
     0.15000    0.95000    0.00000  0.1
     0.18750    0.93750    0.00000  0.1
     0.22500    0.92500    0.00000  0.1
     0.26250    0.91250    0.00000  0.1
     0.30000    0.90000    0.00000  0.1
     0.33750    0.88750    0.00000  0.1
     0.37500    0.87500    0.00000  0.1
     0.41250    0.86250    0.00000  0.1
     0.45000    0.85000    0.00000  0.1
     0.48750    0.83750    0.00000  0.1
     0.52500    0.82500    0.00000  0.1
     0.56250    0.81250    0.00000  0.1
     0.60000    0.80000    0.00000  0.1
     0.63750    0.78750    0.00000  0.1
     0.67500    0.77500    0.00000  0.1
     0.71250    0.76250    0.00000  0.1
     0.75000    0.75000    0.00000  0.1
     0.71250    0.71250    0.00000  0.1
     0.67500    0.67500    0.00000  0.1
     0.63750    0.63750    0.00000  0.1
     0.60000    0.60000    0.00000  0.1
     0.56250    0.56250    0.00000  0.1
     0.52500    0.52500    0.00000  0.1
     0.48750    0.48750    0.00000  0.1
     0.45000    0.45000    0.00000  0.1
     0.41250    0.41250    0.00000  0.1
     0.37500    0.37500    0.00000  0.1
     0.33750    0.33750    0.00000  0.1
     0.30000    0.30000    0.00000  0.1
     0.26250    0.26250    0.00000  0.1
     0.22500    0.22500    0.00000  0.1
     0.18750    0.18750    0.00000  0.1
     0.15000    0.15000    0.00000  0.1
     0.11250    0.11250    0.00000  0.1
     0.07500    0.07500    0.00000  0.1
     0.03750    0.03750    0.00000  0.1
     0.00000    0.00000    0.00000  0.1
     0.02500    0.02500    0.02500  0.1
     0.05000    0.05000    0.05000  0.1
     0.07500    0.07500    0.07500  0.1
     0.10000    0.10000    0.10000  0.1
     0.12500    0.12500    0.12500  0.1
     0.15000    0.15000    0.15000  0.1
     0.17500    0.17500    0.17500  0.1
     0.20000    0.20000    0.20000  0.1
     0.22500    0.22500    0.22500  0.1
     0.25000    0.25000    0.25000  0.1
     0.27500    0.27500    0.27500  0.1
     0.30000    0.30000    0.30000  0.1
     0.32500    0.32500    0.32500  0.1
     0.35000    0.35000    0.35000  0.1
     0.37500    0.37500    0.37500  0.1
     0.40000    0.40000    0.40000  0.1
     0.42500    0.42500    0.42500  0.1
     0.45000    0.45000    0.45000  0.1
     0.47500    0.47500    0.47500  0.1
     0.50000    0.50000    0.50000  0.1
EOF

$ESPRESSO_PW < $ELEMENT.band.in > $ELEMENT.band.out
